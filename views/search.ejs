<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Search books</title>
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <main class="card">
        <h1>Our Books</h1>

        <% if (flash) { %>
            <div class="alert <%= flash.type %>">
                <%= flash.message %>
            </div>
            <% } %>

                <p class="subtitle">
                    Logged in as <strong>
                        <%= member.fname %>
                            <%= member.lname %>
                    </strong>
                </p>

                <form method="GET" action="/books">
                    <label>Filter by Category</label>

                    <details class="category-dropdown">
                        <summary class="category-summary">
                            Select categories
                        </summary>

                        <div class="category-list">
                            <label>
                                <input type="checkbox" name="category" value="Thriller & Mystery"
                                    <%=selectedCategories.includes("Thriller & Mystery") ? "checked" : "" %>> Thriller &
                                Mystery
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Crime"
                                    <%=selectedCategories.includes("Crime") ? "checked" : "" %>> Crime
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Action & Adventure"
                                    <%=selectedCategories.includes("Action & Adventure") ? "checked" : "" %>> Action &
                                Adventure
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Internet & Digital Media"
                                    <%=selectedCategories.includes("Internet & Digital Media") ? "checked" : "" %>>
                                Internet & Digital Media
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Computing"
                                    <%=selectedCategories.includes("Computing") ? "checked" : "" %>> Computing
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Film & Photography"
                                    <%=selectedCategories.includes("Film & Photography") ? "checked" : "" %>> Film &
                                Photography
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Arts"
                                    <%=selectedCategories.includes("Arts") ? "checked" : "" %>> Arts
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Linguistics & Writing"
                                    <%=selectedCategories.includes("Linguistics & Writing") ? "checked" : "" %>>
                                Linguistics & Writing
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Language"
                                    <%=selectedCategories.includes("Language") ? "checked" : "" %>> Language
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Romance"
                                    <%=selectedCategories.includes("Romance") ? "checked" : "" %>> Romance
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Sports"
                                    <%=selectedCategories.includes("Sports") ? "checked" : "" %>> Sports
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Diaries & True Accounts"
                                    <%=selectedCategories.includes("Diaries & True Accounts") ? "checked" : "" %>>
                                Diaries & True Accounts
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Biographies"
                                    <%=selectedCategories.includes("Biographies") ? "checked" : "" %>> Biographies
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Humour"
                                    <%=selectedCategories.includes("Humour") ? "checked" : "" %>> Humour
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Comics & Mangas"
                                    <%=selectedCategories.includes("Comics & Mangas") ? "checked" : "" %>> Comics &
                                Mangas
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Politics"
                                    <%=selectedCategories.includes("Politics") ? "checked" : "" %>> Politics
                            </label>
                        </div>
                    </details>

                    <button class="btn full">Filter</button>
                </form>


                <hr>

                <form method="GET" action="#">
                    <label>Search by Author</label>
                    <input type="text" name="author" placeholder="Enter author name">
                    <button class="btn full">Search by Author</button>
                </form>

                <hr>

                <form method="GET" action="#">
                    <label>Search by Title</label>
                    <input type="text" name="title" placeholder="Enter book title">
                    <button class="btn full">Search by Title</button>
                </form>

                <hr>

                <h3>Items per page</h3>
                <div class="menu">
                    <a class="btn-outline" href="/books?<%= queryString.replace(/limit=\d+/, '') %>&limit=2">2</a>
                    <a class="btn-outline" href="/books?<%= queryString.replace(/limit=\d+/, '') %>&limit=3">3</a>
                    <a class="btn-outline" href="/books?<%= queryString.replace(/limit=\d+/, '') %>&limit=5">5</a>
                    <a class="btn-outline" href="/books?<%= queryString.replace(/limit=\d+/, '') %>&limit=10">10</a>
                    <a class="btn-outline" href="/books?<%= queryString.replace(/limit=\d+/, '') %>&limit=20">20</a>
                </div>

                <% if (books && books.length> 0) { %>
                    <h2 style="margin-top:2rem;">Books</h2>

                    <% books.forEach(book=> { %>
                        <div
                            style="border:1px solid #ddd; padding:1rem; border-radius:10px; margin-bottom:1rem; text-align:left;">
                            <strong>
                                <%= book.title %>
                            </strong><br>
                            <span class="text-small">
                                Author: <%= book.author %><br>
                                    Price: <%= book.price %> SEK<br>
                                        Category: <%= book.category %>
                            </span>
                        </div>
                        <% }) %>
                            <% } %>

                                <% if (totalPages> 1) { %>
                                    <div class="pagination">

                                        <% if (page> 1) { %>
                                            <a href="/books?<%= queryString %>&page=<%= page - 1 %>">← Prev</a>
                                            <% } %>

                                                <% for (let i=Math.max(1, page - 2); i <=Math.min(totalPages, page + 2);
                                                    i++) { %>
                                                    <a href="/books?<%= queryString %>&page=<%= i %>"
                                                        class="<%= i === page ? 'active' : '' %>">
                                                        <%= i %>
                                                    </a>
                                                    <% } %>

                                                        <% if (page < totalPages) { %>
                                                            <a href="/books?<%= queryString %>&page=<%= page + 1 %>">Next
                                                                →</a>
                                                            <% } %>
                                    </div>
                                    <% } %>

                                        <p class="text-small" style="margin-top:2rem;">
                                            <a href="/logged-in">← Back</a>
                                        </p>
    </main>
</body>

</html>